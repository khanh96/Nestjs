### [Websocket](https://docs.nestjs.com/websockets/gateways)


- Gửi request `send-message` nhưng nhận thì phải listen `receive-message`
```ts
@WebSocketGateway()
export class ChatGateway {
  @WebSocketServer()
  server: Server

  // Listen for 'send-message' events from clients
  @SubscribeMessage('send-message')
  handleEvent(@MessageBody() data: { name: string }): { name: string } {
    // Emit 'receive-message' event to all connected clients
    this.server.emit('receive-message', {
      data: `Hello ${data.name}`,
    })
    return data
  }
}

```

- `namespace` trong websocket như route trong nestjs
```ts
@WebSocketGateway({
  namespace: 'payment',
})
```
- `Custom Websocket adapter`: Có thể config port, cors chung cho WebsocketAdapter

```ts websocket.adapter.ts 
import { IoAdapter } from '@nestjs/platform-socket.io'
import { ServerOptions, Server } from 'socket.io'

export class WebsocketAdapter extends IoAdapter {
  createIOServer(port: number, options?: ServerOptions) {

    const server: Server = super.createIOServer(port, {
      ...options,
      cors: {
        origin: '*',
        credentials: true,
      },
    })
    return server
  }
}
```
```ts main.ts
app.useWebSocketAdapter(new WebsocketAdapter(app))
```


- Lifecycle hooks  
  - OnGatewayInit
  - OnGatewayConnection
  - OnGatewayDisconnect