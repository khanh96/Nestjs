### [Caching](https://docs.nestjs.com/techniques/caching)

- Technique caching là là một kỹ thuật đơn giản dểd tối ưu performance. Bằng cách hoạt động như 1 lưu trữ tạm thời. Cho phép access nhanh với data thường xuyên truy cập.

```ts Ecommerce/ecom/src/shared/guards/access-token.guard.ts
// 1. Thử lấy từ cache
let cachedRole = await this.cacheManager.get<CachedRole>(cacheKey)

// 2. Nếu không có trong cache, thì truy vấn từ cơ sở dữ liệu
if (!cachedRole) {
const role = await this.prismaService.role
  .findFirstOrThrow({
    where: {
      id: roleId,
      deletedAt: null,
      isActive: true,
    },
    include: {
      permissions: {
        where: {
          deletedAt: null,
        },
      },
    },
  })
  .catch(() => {
    throw new ForbiddenException()
  })

const permissionObject = keyBy(
  role.permissions,
  (permission) => `${permission.path}:${permission.method}`,
) as CachedRole['permissions']

cachedRole = { ...role, permissions: permissionObject }

console.log('cachedRole=>', cachedRole)

await this.cacheManager.set(cacheKey, cachedRole, 1000 * 60 * 60) // Cache for 1 hour
```