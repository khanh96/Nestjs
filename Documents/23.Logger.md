### [Logger](https://docs.nestjs.com/techniques/logger)



- Nếu muốn ứng dụng tích hợp với các hệ thông ghi nhật ký bên ngoài thì sử dụng thư viện `Pino`

```ts Ecommerce/ecom/src/shared/interceptor/logging.interceptor.ts
import { Injectable, NestInterceptor, ExecutionContext, CallHandler, Logger } from '@nestjs/common'
import { Observable } from 'rxjs'
import { tap } from 'rxjs/operators'

@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  private readonly logger = new Logger(LoggingInterceptor.name)
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    console.log('Before...')
    // log res header
    const request = context.switchToHttp().getRequest()
    const response = context.switchToHttp().getResponse()
    this.logger.log(request.headers)
    // Khu vực này sẽ được thực thi trước khi request được đưa vào controller

    const now = Date.now()
    return next.handle().pipe(
      tap((data) => {
        this.logger.log(`Response status: ${response.statusCode}`, data)
        //
        return console.log(`After... ${Date.now() - now}ms`)
      }),
    )
  }
}
```

```ts Ecommerce/ecom/src/main.ts
const app = await NestFactory.create<NestExpressApplication>(AppModule, {
    logger: new ConsoleLogger({
      json: false,
    }), // Sử dụng ConsoleLogger để ghi log ra console
  })
app.useGlobalInterceptors(new LoggingInterceptor())
```



#### Pino 
- Sử dụng lưu vào file vì log của nest không có lưu vào file

```ts Ecommerce/ecom/src/main.ts
const app = await NestFactory.create<NestExpressApplication>(AppModule, { bufferLogs: true })
  app.useLogger(app.get(Logger))
```

```ts Ecommerce/ecom/src/app.module.ts
LoggerModule.forRoot({
      pinoHttp: {
        serializers: {
          req(req: any) {
            return {
              method: req.method,
              url: req.url,
              query: req.query,
              params: req.params,
            }
          },
          res(res: any) {
            return {
              statusCode: res.statusCode,
            }
          },
        },
        stream: pino.destination({
          dest: path.resolve('logs/app.log'),
          sync: false, // Asynchronous logging
          mkdir: true, // Create the directory if it doesn't exist
        }),
      },
    })
```